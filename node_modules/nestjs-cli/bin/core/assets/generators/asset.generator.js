"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const file_system_utils_1 = require("../../utils/file-system.utils");
const fs = require("fs");
const replace_transform_1 = require("../streams/replace.transform");
const path = require("path");
const logger_service_1 = require("../../logger/logger.service");
const color_service_1 = require("../../logger/color.service");
class AssetGenerator {
    constructor() {
        this._logger = logger_service_1.LoggerService.getLogger();
    }
    generate(asset) {
        const relativeFilename = path.relative(process.cwd(), asset.filename);
        return file_system_utils_1.FileSystemUtils.mkdir(path.dirname(relativeFilename))
            .then(() => {
            return new Promise((resolve, reject) => {
                const reader = fs.createReadStream(asset.template.filename);
                const writer = fs.createWriteStream(asset.filename);
                reader
                    .pipe(new replace_transform_1.ReplaceTransform(asset.template.replacer))
                    .pipe(writer);
                reader.on('end', resolve);
                reader.on('error', reject);
            });
        })
            .then(() => {
            this._logger.info(color_service_1.ColorService.green('create'), relativeFilename);
        });
    }
}
exports.AssetGenerator = AssetGenerator;
