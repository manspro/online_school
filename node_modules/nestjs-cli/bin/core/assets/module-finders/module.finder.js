"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const file_system_utils_1 = require("../../utils/file-system.utils");
const path = require("path");
const util_1 = require("util");
class ModuleFinderImpl {
    constructor() {
        this.MODULE_FILENAME_REGEX = /.*.module.(ts|js)/;
    }
    findFrom(origin) {
        const dirname = path.dirname(origin);
        return this.findIn(dirname);
    }
    findIn(dirname) {
        return file_system_utils_1.FileSystemUtils.readdir(dirname)
            .then(files => {
            const filename = files.find(filename => this.MODULE_FILENAME_REGEX.test(filename));
            if (util_1.isNullOrUndefined(filename)) {
                const elements = dirname.split(path.sep);
                const parent = elements.splice(0, elements.length - 1).join(path.sep);
                return this.findIn(parent);
            }
            else {
                return path.join(dirname, files.find(filename => this.MODULE_FILENAME_REGEX.test(filename)));
            }
        });
    }
}
exports.ModuleFinderImpl = ModuleFinderImpl;
